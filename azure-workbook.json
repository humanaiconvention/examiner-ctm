{
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json",
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 9,
      "content": {
        "json": "## HumanAI Convention Observability\nThis workbook surfaces key client telemetry: configuration drift, web vitals, and fetch dependency health." ,
        "style": "markdown"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "customEvents\n| where name == 'sw_config_drift'\n| extend previous = tostring(customDimensions.previous), current = tostring(customDimensions.current)\n| project TimeGenerated=timestamp, previous, current\n| order by TimeGenerated desc\n| take 50",
        "size": 2,
        "title": "Recent Config Drift Events"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "customEvents\n| where name == 'perf_metric'\n| extend metric=tostring(customDimensions.metric), value= todouble(customDimensions.value), rating = tostring(customDimensions.rating)\n| where metric in ('LCP','INP','CLS')\n| summarize p50=percentile(value,50), p75=percentile(value,75), p95=percentile(value,95) by metric, bin(timestamp, 30m)\n| order by timestamp desc",
        "size": 2,
        "title": "Web Vitals Percentiles (LCP/INP/CLS)"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "customEvents\n| where name == 'fetch_dependency'\n| extend status=toint(tostring(customDimensions.status)), err=tostring(customDimensions.error), dur=toint(customDimensions.duration)\n| summarize success=countif(isnotempty(status) and status < 400), failures=countif(isnotempty(err) or status >= 400), p95_dur=percentile(dur,95) by bin(timestamp, 5m)\n| extend failureRate = failures * 1.0 / (success + failures)\n| order by timestamp desc",
        "size": 2,
        "title": "Fetch Dependency Health"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "customEvents\n| where name == 'perf_metric' and tostring(customDimensions.metric) == 'LCP'\n| extend lcp= todouble(customDimensions.value)\n| summarize p75=percentile(lcp,75) by bin(timestamp, 1h)\n| order by timestamp desc",
        "size": 2,
        "title": "Hourly LCP p75"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "customEvents\n| where name == 'error' or name == 'unhandledrejection'\n| extend msg=tostring(customDimensions.message)\n| summarize count() by name, bin(timestamp, 15m)\n| order by timestamp desc",
        "size": 2,
        "title": "Client Error Volume"
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "customEvents\n| where name == 'error'\n| extend msg=tostring(customDimensions.message)\n| summarize occurrences=count() by msg\n| top 20 by occurrences desc",
        "size": 2,
        "title": "Top Error Messages"
      }
    }
  ],
  "fallbackResourceIds": ["Azure Monitor"]
}
