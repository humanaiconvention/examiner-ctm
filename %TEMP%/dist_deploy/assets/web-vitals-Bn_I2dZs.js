var v,g=-1,M=function(e){addEventListener("pageshow",(function(n){n.persisted&&(g=n.timeStamp,e(n))}),!0)},y=function(){var e=self.performance&&performance.getEntriesByType&&performance.getEntriesByType("navigation")[0];if(e&&e.responseStart>0&&e.responseStart<performance.now())return e},w=function(){var e=y();return e&&e.activationStart||0},p=function(e,n){var t=y(),r="navigate";return g>=0?r="back-forward-cache":t&&(document.prerendering||w()>0?r="prerender":document.wasDiscarded?r="restore":t.type&&(r=t.type.replace(/_/g,"-"))),{name:e,value:-1,rating:"good",delta:0,entries:[],id:"v4-".concat(Date.now(),"-").concat(Math.floor(8999999999999*Math.random())+1e12),navigationType:r}},T=function(e,n,t){try{if(PerformanceObserver.supportedEntryTypes.includes(e)){var r=new PerformanceObserver((function(i){Promise.resolve().then((function(){n(i.getEntries())}))}));return r.observe(Object.assign({type:e,buffered:!0},t||{})),r}}catch{}},h=function(e,n,t,r){var i,a;return function(u){n.value>=0&&(u||r)&&((a=n.value-(i||0))||i===void 0)&&(i=n.value,n.delta=a,n.rating=(function(f,c){return f>c[1]?"poor":f>c[0]?"needs-improvement":"good"})(n.value,t),e(n))}},b=function(e){document.addEventListener("visibilitychange",(function(){document.visibilityState==="hidden"&&e()}))},C=function(e){var n=!1;return function(){n||(e(),n=!0)}},S=function(e){document.prerendering?addEventListener("prerenderingchange",(function(){return e()}),!0):e()},E=0,l=1/0,s=0,N=function(e){e.forEach((function(n){n.interactionId&&(l=Math.min(l,n.interactionId),s=Math.max(s,n.interactionId),E=s?(s-l)/7+1:0)}))},I=function(){return v?E:performance.interactionCount||0},k=function(){"interactionCount"in performance||v||(v=T("event",N,{type:"event",buffered:!0,durationThreshold:0}))},o=[],d=new Map,P=0,O=function(){var e=Math.min(o.length-1,Math.floor((I()-P)/50));return o[e]},x=[],A=function(e){if(x.forEach((function(i){return i(e)})),e.interactionId||e.entryType==="first-input"){var n=o[o.length-1],t=d.get(e.interactionId);if(t||o.length<10||e.duration>n.latency){if(t)e.duration>t.latency?(t.entries=[e],t.latency=e.duration):e.duration===t.latency&&e.startTime===t.entries[0].startTime&&t.entries.push(e);else{var r={id:e.interactionId,latency:e.duration,entries:[e]};d.set(r.id,r),o.push(r)}o.sort((function(i,a){return a.latency-i.latency})),o.length>10&&o.splice(10).forEach((function(i){return d.delete(i.id)}))}}},B=function(e){var n=self.requestIdleCallback||self.setTimeout,t=-1;return e=C(e),document.visibilityState==="hidden"?e():(t=n(e),b(e)),t},m=[200,500],D=function(e,n){"PerformanceEventTiming"in self&&"interactionId"in PerformanceEventTiming.prototype&&(n=n||{},S((function(){var t;k();var r,i=p("INP"),a=function(f){B((function(){f.forEach(A);var c=O();c&&c.latency!==i.value&&(i.value=c.latency,i.entries=c.entries,r())}))},u=T("event",a,{durationThreshold:(t=n.durationThreshold)!==null&&t!==void 0?t:40});r=h(e,i,m,n.reportAllChanges),u&&(u.observe({type:"first-input",buffered:!0}),b((function(){a(u.takeRecords()),r(!0)})),M((function(){P=I(),o.length=0,d.clear(),i=p("INP"),r=h(e,i,m,n.reportAllChanges)})))})))};export{m as INPThresholds,D as onINP};
