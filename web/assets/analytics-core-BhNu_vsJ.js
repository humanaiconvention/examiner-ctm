const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/appInsights-5N3w7y5y.js","assets/analytics-errors-CC2HdOEk.js"])))=>i.map(i=>d[i]);
import{installErrorHooks as ie}from"./analytics-errors-CC2HdOEk.js";const oe="modulepreload",se=function(e){return"/"+e},q={},ae=function(t,n,o){let i=Promise.resolve();if(n&&n.length>0){let c=function(u){return Promise.all(u.map(w=>Promise.resolve(w).then(k=>({status:"fulfilled",value:k}),k=>({status:"rejected",reason:k}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),r=a?.nonce||a?.getAttribute("nonce");i=c(n.map(u=>{if(u=se(u),u in q)return;q[u]=!0;const w=u.endsWith(".css"),k=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${k}`))return;const p=document.createElement("link");if(p.rel=w?"stylesheet":oe,w||(p.as="script"),p.crossOrigin="",p.href=u,r&&p.setAttribute("nonce",r),document.head.appendChild(p),w)return new Promise((ne,re)=>{p.addEventListener("load",ne),p.addEventListener("error",()=>re(new Error(`Unable to preload CSS for ${u}`)))})}))}function s(a){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=a,window.dispatchEvent(r),!r.defaultPrevented)throw a}return i.then(a=>{for(const r of a||[])r.status==="rejected"&&s(r.reason);return t().catch(s)})},ce={quoteTransitionLongFrameMs:120};let z=null;function ue(e){z=e}const le=()=>typeof window<"u";let l={enabled:!1,maxRetries:3,retryBaseDelayMs:400,circuitBreakerThreshold:6,circuitBreakerCooldownMs:6e4,batchSizeLimit:50,batchBytesLimit:3e4};function fe(e){l={...l,...e}}let v=0,h=!1,g=null;function F(e,t){try{z?.({category:"lifecycle",action:e,priority:"high",...t?{metadata:t}:{}})}catch{}}function de(){const e=h;v=0,h=!1,g=null,e&&F("breaker_closed")}function A(){v+=1;const e=l.circuitBreakerThreshold||6;!h&&v>=e&&(h=!0,g=Date.now(),F("breaker_open",{consecutiveFailures:v}))}function he(){return h?g&&Date.now()-g>(l.circuitBreakerCooldownMs||6e4)?(F("breaker_half_open"),!0):!1:!0}const y=[];let E=!1,O=null;function V(){return!!(l.enabled&&l.endpoint)}function we(e){y.push(e),K()}function K(){le()&&O==null&&(O=window.setTimeout(()=>{O=null,x()},3e3))}function x(e=!1){if(V()&&!(!e&&y.length===0)&&he()&&!E){E=!0;try{const t=[];let n=0;const o=l.batchBytesLimit||3e4,i=l.batchSizeLimit||50;for(;y.length&&t.length<i;){const s=y[0],a=JSON.stringify(s).length+1;if(n+a>o&&t.length>0)break;y.shift(),t.push(s),n+=a}if(t.length===0){E=!1;return}N(t,0).finally(()=>{E=!1,y.length&&K()})}catch{E=!1}}}async function N(e,t){const n=l.endpoint,o=l.maxRetries??3,i=JSON.stringify({events:e}),s={"Content-Type":"application/json"};try{const a=await fetch(n,{method:"POST",headers:s,body:i,keepalive:l.useBeacon===!0});if(a.ok)de();else{if(a.status>=400&&a.status<500){A();return}if(t<o){const r=(l.retryBaseDelayMs||400)*Math.pow(2,t);return await new Promise(c=>setTimeout(c,r)),N(e,t+1)}else A(),h||y.unshift(...e)}}catch{if(t<o){const a=(l.retryBaseDelayMs||400)*Math.pow(2,t);return await new Promise(r=>setTimeout(r,a)),N(e,t+1)}else A(),h||y.unshift(...e)}}function ye(){return{enabled:l.enabled,endpoint:l.endpoint,queueLength:y.length,breaker:{open:h,consecutiveFailures:v,openedAt:g}}}const B={_getBreaker:()=>({consecutiveFailures:v,breakerOpen:h,breakerOpenedAt:g}),_resetBreaker:()=>{v=0,h=!1,g=null},_forceHalfOpen:()=>{h&&(g=Date.now()-(l.circuitBreakerCooldownMs||6e4)-10)},_forceFlush:()=>{try{x(!0)}catch{}}},pe=new Set(["userEmail","userId"]);function D(e,t=0,n=new WeakSet,o){if(!e)return e;const i=o||e;if(t>4)return{tooDeep:!0};const s={},a=/[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}/ig;for(const[r,c]of Object.entries(e)){if(c==null){s[r]=c;continue}if(typeof c=="string"&&!pe.has(r)){s[r]=c.replace(a,"[redacted-email]");continue}if(typeof c=="object"){if(c===i){s[r]="[circular]";continue}if(n.has(c)){s[r]="[circular]";continue}n.add(c),Array.isArray(c)?s[r]=c.map(u=>typeof u=="string"?u.replace(a,"[redacted-email]"):u&&typeof u=="object"?D(u,t+1,n,i)||null:u):s[r]=D(c,t+1,n,i)||c;continue}s[r]=c}return s}const ge="haic:analyticsConsent",P="__SESSION_ID__",W="haic:lastFlushTs",Z="__ANALYTICS_USER__",$={heartbeat:.5},_e={_resetBreaker:()=>{try{B._resetBreaker()}catch{}},_forceHalfOpen:()=>{try{B._forceHalfOpen()}catch{}},_forceFlush:()=>{try{x(!0)}catch{}},_getBreaker:()=>{try{return B._getBreaker()}catch{return{}}},_drain:async(e=500)=>{await new Promise(n=>setTimeout(n,5));const t=Date.now();for(;Date.now()-t<e;){await new Promise(n=>setTimeout(n,10));break}}};function me(e){}function R(e){try{localStorage.setItem(W,String(e))}catch{}}function G(){try{const e=localStorage.getItem(W);if(!e)return null;const t=Number(e);return Number.isFinite(t)?t:null}catch{return null}}function d(){return typeof window<"u"}function J(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function m(){return d()?window.__ANALYTICS_CONSENT__===!0:!1}function ve(e){if(d()){window.__ANALYTICS_CONSENT__=e;try{localStorage.setItem(ge,e?"granted":"denied")}catch{}}}function X(){if(d())return window[P]||(window[P]=J()),window[P]}const H=200,S=[];function be(e,t){if(!d())return;const n=window;n[Z]={userId:e,traits:t}}function ke(){return d()?window[Z]:void 0}function Ee(e){const t=$[e];return t==null?!0:Math.random()<t}function Se(e){return S.includes(e)?!1:(S.push(e),S.length>H&&S.splice(0,S.length-H),!0)}const b=[],_=[];let T=null,I=null;function Te(e,t){switch(e){case"interaction":return["click","cta","toggle","sw_auto_refresh","sw_background_notice","sw_update_decision","sw_hard_bust_complete","question_submit"].includes(t);case"config":return["drift"].includes(t);case"navigation":return["page_view","hash_change","section_view"].includes(t);case"perf":return["hero_paint","fid","cls_total","quote_transition","perf_metric"].includes(t);case"engagement":return["focus","visibility_change"].includes(t);case"error":return["exception","unhandled_rejection"].includes(t);case"lifecycle":return["session_start","consent_granted","consent_denied","breaker_open","breaker_half_open","breaker_closed"].includes(t);case"heartbeat":return["interval_ping"].includes(t);case"intro":return["intro_impression","intro_stage_view","intro_completed","intro_safety_fallback"].includes(t);default:return!1}}function C(e){const{category:t="interaction",action:n,label:o,value:i,metadata:s}=e;if(!Ee(t)||!Te(t,n))return;const a=X(),r=J();if(!Se(r))return;const c=ke(),u=D(s),w={event:"custom_event",eventCategory:t,eventAction:n,...o?{eventLabel:o}:{},...typeof i=="number"?{eventValue:i}:{},sessionId:a,eventId:r,...c?{userId:c.userId,userTraits:c.traits}:{},timestamp:Date.now(),...u};try{Array.isArray(window.dataLayer)&&window.dataLayer.push(w)}catch{}try{window.analytics?.track?.(n,{category:t,label:o,value:i,...u,sessionId:a})}catch{}try{window.posthog?.capture?.(n,{category:t,label:o,value:i,...u,sessionId:a})}catch{}V()&&we(w)}function ee(){if(d()&&!T&&(T=window.setTimeout(()=>{j()},4e3),"requestIdleCallback"in window&&I==null)){const e=window.requestIdleCallback;e&&(I=e(()=>j()))}}function j(){if(m()){for(I&&(I=null),T&&(window.clearTimeout(T),T=null);_.length;){const e=_.shift();e&&C(e)}R(Date.now())}}function te(){if(m()){for(;b.length;){const e=b.shift();e&&(e.priority==="low"?_.push(e):C(e))}_.length&&ee(),R(Date.now()),x(!0)}}function f(e){if(d()){if(!m()){b.push(e);return}if(e.priority==="low"){_.push(e),ee();return}C(e)}}function xe(e){f({category:"navigation",action:"hash_change",label:e||"empty"})}function Le(){if(!d())return;if(!m()){b.push({category:"perf",action:"hero_paint",value:Math.round(performance.now())});return}const e=performance.now();f({category:"perf",action:"hero_paint",value:Math.round(e)})}function Ie(e,t,n,o){if(!d())return;const i={metric:e,...o?{phase:o}:{},...n||{}};if(!m()){b.push({category:"perf",action:"perf_metric",value:Math.round(t),metadata:i,priority:"high"});return}f({category:"perf",action:"perf_metric",value:Math.round(t),metadata:i})}function Ce(){X()}let U=null;function Ae(e=300*1e3){if(!d()||U)return;const t=()=>{document.visibilityState==="visible"&&f({category:"heartbeat",action:"interval_ping",priority:"low",metadata:{intervalMs:e}})};U=window.setInterval(t,e),t()}function Oe(){d()&&(window.addEventListener("visibilitychange",()=>{f({category:"engagement",action:"visibility_change",priority:"low",metadata:{state:document.visibilityState}})}),window.addEventListener("focus",()=>{f({category:"engagement",action:"focus",priority:"low"})}))}function Be(e=["mission","vision","voices"]){if(!d()||!("IntersectionObserver"in window))return;const t=new Set,n=new IntersectionObserver(o=>{o.forEach(i=>{if(i.isIntersecting){const s=i.target.getAttribute("id");s&&!t.has(s)&&(t.add(s),f({category:"navigation",action:"section_view",label:s,priority:"low"}))}})},{threshold:.35});e.forEach(o=>{const i=document.getElementById(o);i&&n.observe(i)})}function Pe(){f({category:"lifecycle",action:"consent_granted"}),te();try{ae(()=>import("./appInsights-5N3w7y5y.js"),__vite__mapDeps([0,1])).then(e=>e.enableAppInsightsTelemetry()).catch(()=>{})}catch{}}function Me(){f({category:"lifecycle",action:"consent_denied"})}let Q=!1;function Ne(){if(!d()||Q)return;Q=!0;const e=()=>{if(m()){for(;_.length;){const t=_.shift();t&&C(t)}R(Date.now()),x(!0)}};window.addEventListener("pagehide",e),window.addEventListener("beforeunload",e)}function De(){const e=ye();return{consent:m(),lowPriorityQueue:_.length,preConsentQueue:b.length,backendTransport:e,lastFlushTs:G(),sampling:$}}let M=!1;function Fe(){if(!d()||M)return;const e=()=>{if(M)return;M=!0;const t=performance.now();f({category:"perf",action:"fid",value:Math.round(t)}),window.removeEventListener("pointerdown",e,!0),window.removeEventListener("keydown",e,!0)};window.addEventListener("pointerdown",e,!0),window.addEventListener("keydown",e,!0)}let L=0,Y=!1;function Re(){if(!(!d()||Y||!("PerformanceObserver"in window))){Y=!0;try{new PerformanceObserver(t=>{for(const n of t.getEntries()){const o=n;typeof o.value=="number"&&!o.hadRecentInput&&(L+=o.value)}}).observe({type:"layout-shift",buffered:!0}),window.addEventListener("pagehide",()=>{L>0&&f({category:"perf",action:"cls_total",value:Math.round(L*1e3),metadata:{raw:L}})})}catch{}}}function qe(e,t=ce.quoteTransitionLongFrameMs){e>t&&f({category:"perf",action:"quote_transition",value:Math.round(e),metadata:{threshold:t}})}ue(({category:e,action:t,metadata:n})=>{f(n?{category:e,action:t,priority:"high",metadata:n}:{category:e,action:t,priority:"high"})});const je=Object.freeze(Object.defineProperty({__proto__:null,__test:_e,configureAnalyticsTransport:fe,flushPreConsentQueue:te,getAnalyticsDebugInfo:De,getLastFlushTs:G,hasAnalyticsConsent:m,initAnalyticsSession:Ce,initFirstInputDelayCapture:Fe,initLayoutShiftObserver:Re,initSectionObserver:Be,initVisibilityListeners:Oe,installErrorHooks:ie,onConsentDenied:Me,onConsentGranted:Pe,registerUnloadFlush:Ne,setAnalyticsConsent:ve,setAnalyticsQuietMode:me,setUserContext:be,startHeartbeat:Ae,trackEvent:f,trackHashNavigation:xe,trackHeroPaint:Le,trackPerfMetric:Ie,trackQuoteTransition:qe},Symbol.toStringTag,{value:"Module"}));export{ae as _,Be as a,Ie as b,Fe as c,Re as d,qe as e,f,ve as g,m as h,Oe as i,be as j,Me as k,B as l,fe as m,x as n,Pe as o,Ce as p,te as q,De as r,Ae as s,Le as t,xe as u,je as v};
